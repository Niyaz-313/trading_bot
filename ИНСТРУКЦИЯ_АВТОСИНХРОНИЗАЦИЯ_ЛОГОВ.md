# ИНСТРУКЦИЯ: Автоматическая синхронизация логов с Git

## Проблема:
Сервер не отправляет обновленные файлы (логи, audit-логи) в git автоматически.

## Решение:
Создан скрипт автоматической синхронизации, который будет запускаться через cron каждый час.

---

## Установка на сервере:

### Шаг 1: Загрузить скрипты на сервер

Скопируйте на сервер два файла:
- `server_sync_logs_to_git.sh` - основной скрипт синхронизации
- `setup_cron_sync.sh` - скрипт установки cron задачи

### Шаг 2: Установить cron задачу

Выполните на сервере:

```bash
cd /home/botuser/trading_bot/trading_bot

# Дать права на выполнение
chmod +x setup_cron_sync.sh
chmod +x server_sync_logs_to_git.sh

# Запустить установку
./setup_cron_sync.sh
```

### Шаг 3: Проверка

```bash
# Проверить, что cron задача установлена
crontab -l | grep sync_logs

# Проверить логи синхронизации
tail -f logs/git_sync.log
```

---

## Ручной запуск синхронизации:

Если нужно синхронизировать логи вручную:

```bash
cd /home/botuser/trading_bot/trading_bot
./server_sync_logs_to_git.sh
```

---

## Как это работает:

1. **Cron задача** запускается каждый час в 5 минут
2. **Скрипт синхронизации**:
   - Получает изменения с сервера (git pull)
   - Разрешает конфликты (оставляет версию сервера для логов)
   - Добавляет измененные логи в git
   - Создает коммит с временной меткой
   - Отправляет изменения на сервер (git push)

3. **Логирование**: все действия записываются в `logs/git_sync.log`

---

## Настройка частоты синхронизации:

По умолчанию синхронизация происходит **каждый час в 5 минут**.

Для изменения частоты отредактируйте cron задачу:

```bash
crontab -e
```

Примеры расписания:
- Каждый час: `5 * * * *`
- Каждые 30 минут: `5,35 * * * *`
- Каждые 15 минут: `5,20,35,50 * * * *`
- Раз в день в 23:00: `0 23 * * *`

---

## Получение обновленных логов на локальный ПК:

После того, как сервер отправит логи в git, получите их на локальном ПК:

```batch
cd "C:\Users\karim\OneDrive\Рабочий стол\Bot"
git pull origin main
```

Или используйте `sync_to_server.bat` (он делает pull перед push).

---

## Устранение проблем:

### Проблема: "Permission denied"
```bash
chmod +x server_sync_logs_to_git.sh
chmod +x setup_cron_sync.sh
```

### Проблема: "git push rejected"
Проверьте, что remote URL использует HTTPS:
```bash
git remote get-url origin
# Должно быть: https://github.com/...
```

### Проблема: Конфликты при merge
Скрипт автоматически разрешает конфликты, оставляя версию сервера для логов.

### Проблема: Большие файлы (>50MB)
Скрипт предупреждает о больших файлах, но все равно коммитит их.
GitHub имеет лимит 100MB на файл.

---

## Мониторинг:

### Проверка последней синхронизации:
```bash
tail -50 logs/git_sync.log
```

### Проверка статуса cron:
```bash
systemctl status cron
# или
service cron status
```

### Просмотр всех cron задач:
```bash
crontab -l
```

---

## Отключение автоматической синхронизации:

Если нужно отключить автоматическую синхронизацию:

```bash
crontab -e
# Удалите строку с server_sync_logs_to_git.sh
```

Или удалите все задачи синхронизации:
```bash
crontab -l | grep -v "server_sync_logs_to_git.sh" | crontab -
```



