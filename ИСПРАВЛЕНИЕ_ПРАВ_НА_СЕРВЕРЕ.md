# ИСПРАВЛЕНИЕ: Permission denied для server_update.sh

## Проблема:
```
-bash: ./server_update.sh: Permission denied
```

## Решение:

Выполните на сервере следующие команды:

```bash
cd /home/botuser/trading_bot/trading_bot

# 1. Дать права на выполнение
chmod +x server_update.sh

# 2. Запустить обновление
./server_update.sh

# 3. Перезапустить бота
sudo systemctl restart trading-bot.service

# 4. Проверить статус
sudo systemctl status trading-bot.service --no-pager -l | head -20

# 5. Проверить логи на наличие новых сообщений об ошибках
tail -50 logs/trading_bot.log | grep -i "error\|ошибка\|trading_session"
```

## Альтернатива (если server_update.sh не работает):

Выполните команды вручную:

```bash
cd /home/botuser/trading_bot/trading_bot

# Сохранить локальные логи
git stash push -m "Server logs before pull" audit_logs/ logs/

# Получить изменения
git pull origin main

# Восстановить логи
git stash pop

# Перезапустить бота
sudo systemctl restart trading-bot.service
```

## Проверка применения изменений:

После перезапуска проверьте:

1. **Логи на наличие новых сообщений:**
```bash
tail -100 logs/trading_bot.log | grep -E "trading_session|ОШИБКА РАЗМЕЩЕНИЯ|order_placement_failed"
```

2. **Проверка функции проверки торговой сессии:**
```bash
grep -n "_is_trading_session_open" main.py
```

3. **Проверка улучшенного логирования:**
```bash
grep -n "_last_order_error\|error_details" tinvest_api.py broker_api.py main.py | head -10
```

Если всё работает, вы увидите в логах:
- Сообщения о проверке торговой сессии
- Детальные сообщения об ошибках размещения ордеров с кодами ошибок
- Информацию о времени для ошибок вне торговой сессии




